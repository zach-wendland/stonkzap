# Security & Architecture Pentest Report: Sentiment Bot React Frontend

## Executive Summary
**Risk Level**: MEDIUM
**Critical Issues**: 3
**High Priority**: 5
**Findings**: 12 total

**Verdict**: Plan has fundamental flaws that MUST be fixed before development. Proceeding with original plan will create security vulnerabilities and architectural debt.

---

## üî¥ CRITICAL ISSUES (Block Development)

### 1. API Key Storage Vulnerability
**Issue**: Plan stores API keys in localStorage
```javascript
// VULNERABLE - DO NOT DO THIS
localStorage.setItem('apiKey', userInput)
// Exposed to XSS attacks, can be read by any script
```

**Risk**:
- XSS attack steals API key ‚Üí attacker can run scans, backtest, use up rate limits
- Malicious browser extension reads localStorage
- User logs in on public computer, key persists

**Fix**:
```python
# Backend needs authentication endpoints
POST /auth/login {email, password} ‚Üí returns JWT token
POST /auth/logout
POST /auth/refresh ‚Üí renew token
```
Frontend stores JWT in **httpOnly secure cookie** (not localStorage)

**Implementation**: Add JWT authentication to FastAPI backend first

---

### 2. No Authorization/Access Control
**Issue**: Any authenticated user can access any other user's data

**Risk**:
- User A logs in, sees User B's portfolio
- User A can modify/delete User B's trades
- No multi-tenancy separation

**Fix**:
- Add user table to database
- Every portfolio/trade record has `user_id` foreign key
- Middleware checks: `POST /portfolio` ‚Üí only user's own records

**Status**: Requires backend changes

---

### 3. Unencrypted Sensitive Data
**Issue**: Redux state contains unencrypted portfolio data, API responses

**Risk**:
- State leaked in error logs/monitoring
- DevTools extension can inspect state
- Stored in browser memory unencrypted

**Fix**:
- Don't store sensitive data in Redux (positions, real P&L)
- Only store references/IDs
- Fetch actual data server-side only
- Use encrypted local storage if needed (TweetNaCl.js)

---

## üü† HIGH PRIORITY (Must fix before MVP)

### 4. Missing CORS Configuration
**Issue**: React frontend on `localhost:3000`, API on `localhost:8000`

**Risk**:
- CORS rejection blocks all API calls
- Frontend can't connect to backend

**Fix**:
```python
# In FastAPI app/main.py
from fastapi.middleware.cors import CORSMiddleware

app.add_middleware(
    CORSMiddleware,
    allow_origins=["http://localhost:3000", "https://yourdomain.com"],
    allow_credentials=True,
    allow_methods=["*"],
    allow_headers=["*"],
)
```

**Status**: Quick fix, must do before testing

---

### 5. No Input Validation/Sanitization
**Issue**: Plan doesn't mention validation on form inputs

**Risk**:
- User enters malicious SQL in trade notes ‚Üí stored in DB
- User enters XSS payload in strategy name
- User enters huge numbers in position size ‚Üí overflow

**Fix**:
- Frontend: Zod or Yup schema validation
- Backend: Pydantic already validates (good!)
- Sanitize text before storage

```javascript
// Use Zod for schemas
const tradeSchema = z.object({
  symbol: z.string().regex(/^[A-Z]{1,5}$/),
  entryPrice: z.number().positive().max(100000),
  quantity: z.number().positive().int().max(10000),
  notes: z.string().max(500).optional()
})
```

---

### 6. State Management Overengineering
**Issue**: Redux Toolkit might be overkill for this use case

**Problems**:
- Adds 30KB+ to bundle
- Boilerplate for slices, actions, reducers
- Context API or Zustand sufficient
- Most data comes from API (React Query handles it)

**Better Approach**:
```javascript
// Use React Query + Zustand combo
// React Query: API data (opportunities, backtest results)
// Zustand: UI state (filters, dark mode, user preferences)

// Much lighter, less boilerplate
const useUIStore = create((set) => ({
  darkMode: true,
  filters: {},
  setFilters: (f) => set({filters: f})
}))

const { data: opportunities } = useQuery(['scan'], () => api.scan())
```

**Recommendation**: Use **Zustand** (lightweight) + **React Query** (API state)

---

### 7. No TypeScript
**Issue**: Plan doesn't specify TypeScript

**Risk**:
- Type errors caught at runtime, not development
- Refactoring causes breaking changes
- API response types out of sync with backend

**Fix**: Add TypeScript + generate types from API
```bash
npm install -D typescript
npm install -D @openapi-generator-cli
# Auto-generate types from FastAPI openapi.json
```

**Status**: MUST add before starting

---

### 8. Inadequate Error Handling
**Issue**: Plan mentions error boundaries but no strategy

**Risk**:
- API error ‚Üí blank screen (no user feedback)
- Network timeout ‚Üí no retry
- Rate limit hit ‚Üí no warning

**Fix**:
```javascript
// Centralized error handler
const apiClient = axios.create({
  baseURL: 'http://localhost:8000'
})

apiClient.interceptors.response.use(
  res => res,
  error => {
    if (error.response?.status === 429) {
      // Rate limited
      toast.error('Rate limited. Please wait 60 seconds.')
      return Promise.reject(error)
    }
    if (error.response?.status === 401) {
      // Unauthorized - refresh token or redirect to login
      redirectToLogin()
    }
    // Log to Sentry for monitoring
    captureException(error)
    return Promise.reject(error)
  }
)
```

**Status**: Design this before starting

---

### 9. No Pagination Strategy
**Issue**: Trade journal could have 1000+ trades, plan shows all at once

**Risk**:
- Browser crashes rendering 1000 rows
- Network request too large
- API times out fetching all trades

**Fix**:
- Backend: `GET /trades?page=1&limit=50` with offset/limit
- Frontend: React Query handles pagination
- Use table virtualization (react-window) for large datasets

---

### 10. Missing Monitoring/Observability
**Issue**: No error tracking, performance monitoring, or logging

**Risk**:
- User reports bug, can't reproduce
- Performance degradation unnoticed
- API errors silent

**Fix**:
```javascript
// Install Sentry
import * as Sentry from "@sentry/react"

Sentry.init({
  dsn: "https://your-sentry-project",
  environment: process.env.NODE_ENV,
  tracesSampleRate: 0.1,
})

// Now errors automatically tracked
```

---

## üü° MEDIUM PRIORITY (Important but not blocking)

### 11. No Accessibility (a11y)
**Issue**: Plan doesn't mention WCAG 2.1 compliance

**Risk**:
- Unusable for screen reader users
- Keyboard navigation broken
- Color contrast issues

**Fix**:
- Use semantic HTML (`<button>` not `<div>`)
- Add ARIA labels
- Test with axe DevTools
- Keyboard shortcuts documented

---

### 12. Performance Not Analyzed
**Issue**: No mention of bundle size, lazy loading, code splitting

**Risk**:
- Initial load > 10 seconds on slow connection
- Charts library bloats bundle
- React Query caching not optimized

**Fix**:
- Code split routes: Dashboard, Scanner, etc. load separately
- Lazy load charts (only load when tab clicked)
- Tree-shake unused dependencies
- Target bundle size: <250KB gzipped

---

## ‚úÖ FIXES BEFORE DEVELOPMENT

### Backend Changes Required (Must Complete First)

**1. Add Authentication**
```python
# app/auth.py
from fastapi import APIRouter, Depends, HTTPException
from passlib.context import CryptContext
from jose import JWTError, jwt
from datetime import timedelta

router = APIRouter()

@router.post("/auth/login")
def login(email: str, password: str):
    # Verify credentials
    # Return JWT token
    pass

@router.post("/auth/logout")
def logout(token: str = Depends(get_current_user)):
    # Invalidate token (add to blacklist or DB)
    pass
```

**2. Add User Management**
```sql
CREATE TABLE users (
  id SERIAL PRIMARY KEY,
  email VARCHAR UNIQUE NOT NULL,
  password_hash VARCHAR NOT NULL,
  created_at TIMESTAMP DEFAULT NOW()
);

ALTER TABLE social_posts ADD COLUMN user_id INT REFERENCES users(id);
-- Same for trades, positions, portfolios
```

**3. Add Portfolio Endpoints**
```python
@router.post("/portfolio")
def create_position(position: PositionCreate, user_id: int = Depends(get_current_user)):
    # Save to DB with user_id
    pass

@router.get("/portfolio")
def get_positions(user_id: int = Depends(get_current_user)):
    # Return only this user's positions
    pass

@router.delete("/portfolio/{position_id}")
def close_position(position_id: int, user_id: int = Depends(get_current_user)):
    # Verify ownership before deleting
    pass
```

**4. Add Trade Journal Endpoints**
```python
@router.post("/trades")
def log_trade(trade: TradeCreate, user_id: int = Depends(get_current_user)):
    pass

@router.get("/trades")
def get_trades(
    user_id: int = Depends(get_current_user),
    page: int = 1,
    limit: int = 50,
    symbol: str = None,
    status: str = None
):
    # Paginated with filters
    pass

@router.get("/trades/statistics")
def get_trade_statistics(user_id: int = Depends(get_current_user)):
    # Win rate, profit factor, etc.
    pass
```

**5. Fix CORS**
```python
# In main.py
app.add_middleware(
    CORSMiddleware,
    allow_origins=["http://localhost:3000", "http://localhost:5173"],
    allow_credentials=True,
    allow_methods=["GET", "POST", "PUT", "DELETE"],
    allow_headers=["*"],
)
```

**Estimate**: 3-4 hours

---

### Frontend Changes Required (Before Coding)

**1. Add TypeScript**
```bash
npm create vite@latest sentiment-bot-frontend -- --template react-ts
cd sentiment-bot-frontend
npm install
```

**2. Add Required Dependencies**
```bash
npm install @tanstack/react-query axios zustand zod
npm install @mui/material @emotion/react @emotion/styled
npm install lightweight-charts
npm install axios-retry sentry
npm install -D @types/react @types/node
```

**3. Setup Type Safety**
```typescript
// src/types/api.ts
export interface Opportunity {
  symbol: string
  company_name: string
  conviction_score: number
  signal_type: 'momentum' | 'reversal' | 'catalyst'
  sentiment_polarity: number
  price_change_7d: number
  trade_setup: {
    entry: number
    stop_loss: number
    target_1: number
    target_2: number
    target_3: number
    position_size: number
  }
}

export interface Position {
  id: string
  symbol: string
  entry_price: number
  quantity: number
  stop_loss: number
  target_1: number
  status: 'open' | 'closed'
  opened_at: string
}
```

**4. Simplify State Management**
```typescript
// src/store/ui.ts
import { create } from 'zustand'

export const useUIStore = create((set) => ({
  darkMode: true,
  filters: { conviction: 5, signalType: null },
  setFilters: (filters) => set({ filters }),
}))
```

---

## üéØ REVISED IMPLEMENTATION ORDER

### Phase 0: Backend Preparation (Must do first)
- [ ] Add JWT authentication
- [ ] Create users table
- [ ] Add user_id to existing tables
- [ ] Build portfolio endpoints (CRUD)
- [ ] Build trade journal endpoints
- [ ] Fix CORS configuration
- [ ] Test all endpoints in Postman
- **Estimate**: 4-6 hours

### Phase 1: React Setup & Integration (Week 1)
- [ ] Create Vite + React + TypeScript project
- [ ] Setup Axios with JWT interceptors
- [ ] Connect to backend (test /scan endpoint)
- [ ] Build Layout (Header, Sidebar, Navigation)
- [ ] Build Dashboard (read-only, show data)
- [ ] Add error handling & loading states

### Phase 2: Core Features (Week 2)
- [ ] Market Scanner page
- [ ] Backtest page
- [ ] Authentication (login/logout)
- [ ] API integration complete

### Phase 3: Trading Features (Week 3)
- [ ] Portfolio management (CRUD positions)
- [ ] Trade journal
- [ ] Statistics dashboard

### Phase 4: Polish & Deploy (Week 4)
- [ ] Dark mode
- [ ] Error tracking (Sentry)
- [ ] Performance optimization
- [ ] Docker build
- [ ] Deploy to Vercel

---

## üîí Security Checklist Before MVP

- [ ] **Authentication**: JWT tokens, httpOnly cookies
- [ ] **Authorization**: User_id checks on every endpoint
- [ ] **Input Validation**: Zod schemas on all forms
- [ ] **CORS**: Properly configured for frontend domain
- [ ] **Rate Limiting**: Backend rate limits per user
- [ ] **Error Messages**: Don't leak sensitive info
- [ ] **Secrets Management**: No API keys in frontend code
- [ ] **HTTPS**: Required for production (even localhost)
- [ ] **Password Hashing**: bcrypt or argon2 on backend
- [ ] **SQL Injection**: Using ORM/parameterized queries (Pydantic does this)

---

## üìä Architecture Comparison

**Original Plan**: Redux + Material-UI + TradingView
**Issues**: Overkill, security flaws, no auth

**Recommended**: React Query + Zustand + Recharts + TypeScript
**Benefits**:
- Lighter bundle (50KB vs 200KB)
- Better API integration (React Query built for it)
- Type-safe (catch errors at dev time)
- Simpler state (UI state only in Zustand)

---

## VERDICT

**‚ùå DO NOT START DEVELOPMENT YET**

**Blockers to resolve:**
1. Add JWT authentication to backend (4 hours)
2. Create portfolio/trade endpoints (3 hours)
3. Fix CORS configuration (30 min)
4. Plan TypeScript types

**Then proceed with revised plan above**

**If you proceed without these changes:**
- ‚ùå Vulnerable to attacks
- ‚ùå Data privacy violations
- ‚ùå Can't deploy to production
- ‚ùå Rework needed later (costly)

**Recommendation**: Spend 4-6 hours on backend auth/endpoints NOW, then build rock-solid frontend in parallel.

Ready to build backend auth/endpoints first, or questions?
